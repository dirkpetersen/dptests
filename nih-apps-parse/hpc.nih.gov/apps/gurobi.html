<script type="text/javascript" language="JavaScript" src='/js/header.js'></script>
<!-- Start content - do not edit above this line  -->
<script type='text/javascript' language='JavaScript'>document.querySelector('title').textContent = 'Gurobi on Biowulf';</script>
<div class="title">Gurobi on Biowulf</div>

<table width=25% align=right>
  <tr>
    <td>
      <div class="toc">
        <div class="tocHeading">Quick Links</div>
        <div class="tocItem"><A href="#doc">Documentation</a></div>
        <div class="tocItem"><a href="#notes">Notes</a></div>
        <div class="tocItem"><a href="#int">Interactive job </a></div>
        <div class="tocItem"><a href="#sbatch">Batch job </a></div>
        <div class="tocItem"><a href="#swarm">Swarm of jobs </a></div>
        <div class="tocItem"><a href="#python_api">Python API</a></div>
        <div class="tocItem"><a href="#R">Gurobi and R </a></div>
        <div class="tocItem"><a href="#hatchet">HATCHet </a></div>
      </div>
</table>

<p>
Gurobi is a mathematical optimization solver. It is a commercial product developed by <A href="https://www.gurobi.com">gurobi.com</a>
</p>
On Biowulf, Gurobi is licensed for use by the members of the CDSL_Gurobi_users group only. It is installed in /data/CDSL_Gurobi_users and is not accessible by any other users.
<P>
The current version of Gurobi on Biowulf is 10.0.0; previous available versions are 9.1.0 and 9.0.0; some examples below may have been generated by a previous version.
  
<p>
If you are interested in 
using Gurobi on Biowulf, please contact Schaffer, Alejandro (NIH/NCI) [E] (alejandro.schaffer@nih.gov), who manages the Gurobi license and
the CDSL_Gurobi_users group. 
<P>
Gurobi should be cited in any publications that result from your use of Gurobi on Biowulf, either directly or via a 3rd-party application.
<P>
<a Name="doc"></a><div class="heading">Documentation</div>
<ul>
<li><a href="http://www.gurobi.com/">Gurobi Website</a></li>
</ul>
<P>
<a Name="notes"></a><div class="heading">Important Notes</div>
<ul>
    <li>Module Name: <tt>gurobi</tt> (see <a href="/apps/modules.html">the modules page</a> for more information)
	<li>Multithreaded -- see <a href="https://www.gurobi.com/documentation/10.0/refman/threads.html">https://www.gurobi.com/documentation/10.0/refman/threads.html</a> for more info.
<li>Environment variables set <!--for ones users should be aware of -->
  <ul>
    <li><tt>GUROBI_HOME=/data/CDSL_Gurobi_users/gurobi1000/linux64</tt></li>
    <li><tt>GRB_LICENSE_FILE=/data/CDSL_Gurobi_users/gurobi1000/gurobi.lic</tt></li>
  </ul>
</ul>
<P>
<a Name="startup"></a><div class="heading">Startup</div>
<P>
A module file, accessible only to the members of the CDSL_Gurobi_users  group, will set the appropriate paths and environment variables for Gurobi. Members of the CDSL_Gurobi_users  group should add the following line into their /home/$USER/.bashrc
<P>
<pre class="term">
module use --prepend /data/CDSL_Gurobi_users/modules
</pre>
This will allow you to load the Gurobi module with 'module load gurobi'.

<a Name="lic"></a><div class="heading">License Server</div>
<P>
The Gurobi license server runs on the Biowulf login node. 
When the login node is rebooted (monthly), the Gurobi license server will be terminated. If that happens, it will need to be restarted by a member of the 
CDSL_Gurobi_users 
group. Only one person needs to start the license server, after which any member of the group can run Gurobi. 
<P>
<A href="https://www.gurobi.com/documentation/9.0/quickstart_linux/index.html">License-related Gurobi docs</a>
<dl>
<dt><b>Check the status of the license server</b></dt>
<dd>On the Biowulf login node, run a 'ps' command and look for the 'grb_ts' process. e.g.
<pre class="term">
[user@biowulf]$ ps auxw | grep grb_ts
user  78377  0.0  0.0  14620  5732 ?        S    Jan21   0:01 grb_ts
</pre>
<P>
<dt><b>Start up the license server</b></dt>
<dd>If you don't see the grb_ts process running, the license server needs to be started. The Gurobi license is currently set up to use port 41954. 

<pre class="term">
[user@biowulf]$  <b>module load gurobi</b>
[+] Loading Gurobi 9.0.0  ...

[user@biowulf]$ <b>grb_ts </b>
Gurobi Token Server version 9.0.0
Gurobi Token Server version 9.0.0 started: Wed Jan 22 09:54:26 2020
Gurobi Token Server syslog: /var/log/syslog or /var/log/messages
Gurobi license file: /data/CDSL_Gurobi_users/gurobi910/gurobi.lic
Gurobi Token Server use limit: 4096
</pre>
In case you get an error because that port is in use, you may need to change the port. It is best to contact the Biowulf staff (staff@hpc.nih.gov) to
ask for an unused port number, as the Biowulf firewall rules will also need to be changed for the new port. Once you have the new port number, make a copy of the license file as a backup
(/data/CDSL_Gurobi_users/gurobi910/gurobi.lic), then edit the main file very carefully and change the port number. Then start the license server with <tt>grb_ts</tt>.

<P>
<dt><b>Stop the license server</b></dt>
<dd>In case the license server needs to be stopped: 
<pre class="term">
[user@biowulf]$ <b>grb_ts -s</b>
Gurobi Token Server version 9.0.0
Gurobi Token Server (pid 78377) killed
</pre>
<P>
</dd>
<P>




<a Name="int"></a><div class="heading">Interactive job</div>
<div class="nudgeblock"><a href="/docs/userguide.html#int">Interactive jobs</a> should be used for debugging, graphics, or applications that cannot be run as batch jobs.</div>
<p>Allocate an <a href="/docs/userguide.html#int">interactive session</a> and run the program. <br>Sample session (user input in <b>bold</b>):</p>
<pre class="term">
[user@biowulf]$ <b>sinteractive</b>
salloc.exe: Pending job allocation 46116226
salloc.exe: job 46116226 queued and waiting for resources
salloc.exe: job 46116226 has been allocated resources
salloc.exe: Granted job allocation 46116226
salloc.exe: Waiting for resource configuration
salloc.exe: Nodes cn3144 are ready for job

[user@cn3144 ~]$ <b>module load gurobi</b>
[+] Loading Gurobi 9.0.0  ...

[user@cn3144 ~]$ <b>gurobi_cl $GUROBI_HOME/examples/data/coins.lp</b>
Using license file /data/CDSL_Gurobi_users/gurobi910/gurobi.lic
Set parameter TokenServer to value biowulf.nih.gov
Set parameter TSPort to value 46325
Set parameter Username
Set parameter LogFile to value gurobi.log

Gurobi Optimizer version 9.0.0 build v9.0.0rc2 (linux64)
Copyright (c) 2019, Gurobi Optimization, LLC

Read LP format model from file /data/CDSL_Gurobi_users/gurobi910/linux64/examples/data/coins.lp
Reading time = 0.00 seconds
: 4 rows, 9 columns, 16 nonzeros
Optimize a model with 4 rows, 9 columns and 16 nonzeros
Model fingerprint: 0x5ce1d538
Variable types: 4 continuous, 5 integer (0 binary)
Coefficient statistics:
  Matrix range     [6e-02, 7e+00]
  Objective range  [1e-02, 1e+00]
  Bounds range     [5e+01, 1e+03]
  RHS range        [0e+00, 0e+00]
Found heuristic solution: objective -0.0000000
Presolve removed 1 rows and 5 columns
Presolve time: 0.00s
Presolved: 3 rows, 4 columns, 9 nonzeros
Variable types: 0 continuous, 4 integer (0 binary)

Root relaxation: objective 1.134615e+02, 2 iterations, 0.00 seconds

    Nodes    |    Current Node    |     Objective Bounds      |     Work
 Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time

     0     0  113.46154    0    1   -0.00000  113.46154      -     -    0s
H    0     0                     113.4500000  113.46154  0.01%     -    0s
     0     0  113.46154    0    1  113.45000  113.46154  0.01%     -    0s

Explored 1 nodes (2 simplex iterations) in 0.02 seconds
Thread count was 32 (of 72 available processors)

Solution count 2: 113.45 -0

Optimal solution found (tolerance 1.00e-04)
Best objective 1.134500000000e+02, best bound 1.134500000000e+02, gap 0.0000%

[user@cn3144 ~]$ <b>exit</b>
salloc.exe: Relinquishing job allocation 46116226
[user@biowulf ~]$
</pre>

<P>
<a Name="sbatch"></a><div class="heading">Batch job</div>
<div class="nudgeblock">Most jobs should be run as <A href="/docs/userguide.html#submit">batch jobs</a>.</div>
<p>Create a batch input file (e.g. Gurobi.sh). For example:</p>

<pre class="term">
#!/bin/bash
set -e
module load gurobi 
gurobi_cl   ResultFile=coins.sol   $GUROBI_HOME/examples/data/coins.lp
</pre>
<p>Submit this job using the Slurm <a href="/docs/userguide.html">sbatch</a> command.</p>

<pre class="term">sbatch [--cpus-per-task=#] [--mem=#] [--time=DD-HH:MM:SS] Gurobi.sh</pre>
where
<table border=0>
  <tr><td width=20%><tt>--cpus-per-task<i>#</i> </tt><td>Number of CPUs allocated for the job. (default=2)
  <tr><td><tt>--mem<i>#</i></tt> <td>Memory allocated for the job (default=4 GB)
  <tr><td><tt>--time=DD-HH:MM:SS</tt> <td>Walltime allocated for the job. (default = 2 hrs)
</table>





<a Name="swarm"></a><div class="heading">Swarm of Jobs </div>
<div class="nudgeblock">A <a href="/apps/swarm.html">swarm of jobs</a> is an easy way to submit a set of independent commands requiring identical resources.</div>

<p>Create a swarmfile (e.g. Gurobi.swarm). For example:</p>

<pre class="term">
gurobi_cl   ResultFile=file1.sol   file1.lp
gurobi_cl   ResultFile=file2.sol   file2.lp
gurobi_cl   ResultFile=file3.sol   file3.lp
[...]
</pre>

<p>Submit this job using the <a href='/apps/swarm.html'>swarm</a> command.</p>

<pre class="term">swarm [-g #] [-t #] --module gurobi Gurobi.swarm</pre>
where
<table border=0>
  <tr><td width=20%><tt>-g <i>#</i> </tt><td>Number of Gigabytes of memory required for each process (1 line in the swarm command file)
  <tr><td><tt>-t <i>#</i></tt> <td>Number of threads/CPUs required for each process (1 line in the swarm command file).
  <tr><td><tt>--module gurobi</tt> <td>Loads the Gurobi module for each subjob in the swarm 
</table>
<P>

<!-- Start Python API -->

  <a Name="python_api"></a><div class="heading">Python API</div>
  <p>To create and solve optimization models using the Python API for Gurobi, the user needs to install the appropriate version of the <code>gurobipy</code> package in their Python environment. 
    That is, if you want to use Gurobi 10.0.0 on Biowulf, it is recommended to install the same version of <code>gurobipy</code>. 
  
  
  <p>  
    <dt><b>Installing the Python API for Gurobi</b></dt>
    <dd>
    If the user already uses <code>Anaconda</code> for package management, it is recommended to install the Python API using the following command in the appropriate conda 
  environment:</p>
  
  <pre class="term">conda install -c gurobi gurobi=10.0.0</pre>
  
  It could also be installed using pip in an active Python environment (managed through Anaconda or otherwise) as follows:
  
  <pre class="term">python -m pip install gurobipy==10.0.0</pre>
  
  See another alternate way to install the API here: <a href="https://support.gurobi.com/hc/en-us/articles/360044290292-How-do-I-install-Gurobi-for-Python-">https://support.gurobi.com/hc/en-us/articles/360044290292-How-do-I-install-Gurobi-for-Python-</a>
    </dl>
  </p>

  <p>
  <dt><b>Running Gurobi using its Python API</b></dt>
  <dd>Once the <code>gurobipy</code> module is installed in a Python environment, it can be imported into Python scripts with <code>import gurobipy</code>. 
  To run a Python script containing the <code>gurobipy</code> module on the compute cluster, the environment module <code>gurobi</code> needs to be loaded beforehand. 
  The easiest way to do this is to wrap the Python command in a shell script. 
  For instance, if <code>example.py</code> is the Python script containing calls to <code>gurobipy</code> that needs to be run on the cluster, write <code>bash_wrapper.sh</code> as follows:
  <pre class="term">
  #!/bin/bash
  module load gurobi/10.0.0  
  python example.py [arguments to example.py]</pre>
  
  Submit the wrapper script to the cluster:
  <pre class="term">sbatch bash_wrapper.sh</pre>
  </dd>
  </p>

<!-- End Python API-->




<p>
  <A Name="R"></a>
    <div class="heading">Gurobi and R</div>
    <P>
    To get Gurobi 10.0.0 to work with R, follow these steps.
    <ol>
    <li>Make sure that a grb_ts process is running on the Biowulf login node. This is the Gurobi license process.
    <pre class="term">
    ps -aux | grep grb_ts</pre>
    If the process is not running, the Gurobi license server needs to be started using the instructions above.
    <P>
    <li>Start an interactive session, set the environment variables, load the Gurobi module and start R as below.
    
    <pre class="term">
    biowulf% <b>sinteractive</b>
    salloc: Pending job allocation 58068017
    salloc: job 58068017 queued and waiting for resources
    salloc: job 58068082 has been allocated resources
    salloc: Granted job allocation 58068082
    salloc: Waiting for resource configuration
    salloc: Nodes cn4294 are ready for job
    
    [user@cn4294 ~]$<b> GUROBI_HOME=/data/CDSL_Gurobi_users/gurobi1000/linux64</b>
    [user@cn4294 ~]$<b> GRB_LICENSE_FILE=/data/CDSL_Gurobi_users/gurobi1000/gurobi.lic</b>
    
    [user@cn4294 ~]$<b> module load gurobi</b>
    
    [user@cn4294 ~]$<b> module load R</b>
    
    [user@cn4294 ~]$<b> R</b>
    
    ><b> install.packages("/data/CDSL_Gurobi_users/gurobi1000/linux64/R/gurobi_10.0-0_R_4.2.0.tar.gz", repos=NULL)</b>    </pre>
    
    </ol>  





  <a Name="hatchet"></a>
<div class="heading">HATCHet </div>
<P>
HATCHet is an algorithm to infer allele and clone-specific copy-number aberrations (CNAs), clone proportions, and whole-genome duplications (WGD) for several tumor clones jointly from multiple bulk-tumor samples of the same patient or from a single bulk-tumor sample. HATCHet has been designed and developped by Simone Zaccaria in the group of prof. Ben Raphael at Princeton University. 
<P>
<a href="https://github.com/raphael-group/hatchet">HATCHet documentation on github</a>
<P>
HATCHet requires Gurobi, and therefore is only available to the members of the CDSL_Gurobi_users group on Biowulf. It has been installed as a 
conda environment: to use HATCHet, you will need to source the conda setup script as in the example below. HATCHet also
requires specific versions of samtools and bcftools. bcftools 1.6 is included in samtools/1.6
<P>
<b>Note: conda initializations in your .bashrc might cause problems with loading the hatchet module.</b> In general it is best not to include any conda initializations in your startup files. 
<P>
Sample HATCHet run in an interactive session (user input in <b>bold</b>)
<pre class="term">
biowulf% <b>sinteractive</b>
salloc.exe: Pending job allocation 9064763
salloc.exe: job 9064763 queued and waiting for resources
salloc.exe: job 9064763 has been allocated resources
salloc.exe: Granted job allocation 9064763
salloc.exe: Waiting for resource configuration
salloc.exe: Nodes cn0878 are ready for job

cn0878% <b>module use --prepend /data/CDSL_Gurobi_users/modules/ </b>

cn0878% <b>module load gurobi</b>
[+] Loading Gurobi 9.1.0  ...

cn0878% <b>module load samtools/1.6 </b>
[+] Loading samtools 1.6  ...

cn0878% <b>source /data/CDSL_Gurobi_users/hatchet/conda/etc/profile.d/conda.sh</b>

cn0878% <b>which conda </b>
/data/CDSL_Gurobi_users/hatchet/conda/bin/conda

cn0878% <b>conda activate hatchet</b>

(hatchet) cn0878% <b>conda env list</b>
# conda environments:
#
base                     /data/CDSL_Gurobi_users/hatchet/conda
hatchet               *  /data/CDSL_Gurobi_users/hatchet/conda/envs/hatchet

(hatchet) cn0878% <b>python3</b>
Python 3.7.4 (default, Oct 29 2019, 10:15:53)
[GCC 4.4.7 20120313 (Red Hat 4.4.7-18)] on linux
Type "help", "copyright", "credits" or "license" for more information.
>> <b>import hatchet</b>
>> [...]
>> <b>quit()</b>

(hatchet) cn0878% <b>conda deactivate</b>

cn0878% <b>exit</b>
salloc.exe: Relinquishing job allocation 9064763

biowulf% 
</pre>

<P>
Sample batch script:
<pre class="term">
#!/bin/bash

module use --prepend /data/CDSL_Gurobi_users/modules/ 
module load gurobi samtools/1.6
source /data/CDSL_Gurobi_users/hatchet/conda/etc/profile.d/conda.sh
conda activate hatchet

python3 &lt;&lt; EOF
import hatchet
[...python commands...]
EOF

conda deactivate
</pre>

<p>
See examples of HATCHet use at <a href=" https://github.com/raphael-group/hatchet/blob/master/examples/demo-WES/demo-wes.sh">
 https://github.com/raphael-group/hatchet/blob/master/examples/demo-WES/demo-wes.sh</a> and 
 <a href="https://github.com/raphael-group/hatchet/tree/master/script">https://github.com/raphael-group/hatchet/tree/master/script</a>.

<P>







<!-- End content area - do not edit below this line -->
<script type="text/javascript" language="JavaScript" src='/js/footer.js'></script>
